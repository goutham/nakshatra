#
# Build environments
#

env = Environment(
    CCFLAGS = ['-std=c++20', '-flto', '-O3', '-Wall', '-march=native'],
    CPPPATH = '.')

test_env = Environment(
    CCFLAGS = '-std=c++20',
    CPPPATH = ['.', 'gtest/include', 'gtest'])

#
# Libraries
#

common = env.Library(
    target = 'common',
    source = ['common.cpp',
              'fen.cpp'])

board = env.Library(
    target = 'board',
    source = ['board.cpp',
              'zobrist.cpp'])

movegen = env.Library(
    target = 'movegen',
    source = ['movegen.cpp',
              'see.cpp',
              'attacks.cpp',
              'san.cpp'])

evaluator = env.Library(
    target = 'evaluator',
    source = ['eval_antichess.cpp',
              'eval_standard.cpp',
              'egtb.cpp',
              'pawns.cpp'])

player = env.Library(
    target = 'player',
    source = ['player.cpp',
              'pn_search.cpp',
              'id_search.cpp',
              'move_order.cpp',
              'pv_search.cpp',
              'transpos.cpp'])

executor = env.Library(
    target = 'executor',
    source = ['executor.cpp'])

egtb_gen = env.Library(
    target = 'egtb_gen',
    source = ['egtb_gen.cpp'])

#
# Executables
#

nakshatra = env.Program(
    target = 'nakshatra',
    source = ['nakshatra.cpp'],
    LIBS = [executor,
            player,
            evaluator,
            movegen,
            board,
            common,
            'pthread'],
    LIBPATH = '.')

pns_analyze = env.Program(
    target = 'pns_analyze',
    source = ['pns_analyze.cpp'],
    LIBS = [player,
            evaluator,
            movegen,
            board,
            common],
    LIBPATH = '.')

movegen_perf = env.Program(
    target = 'movegen_perf',
    source = ['movegen_perf.cpp'],
    LIBS = [movegen,
            board,
            common],
    LIBPATH = '.')

egtb_gen_main = env.Program(
    target = 'egtb_gen_main',
    source = ['egtb_gen_main.cpp'],
    LIBS = [egtb_gen,
            evaluator,
            movegen,
            board,
            common],
    LIBPATH = '.')

#
# Tests
#

unit_tests = test_env.Program(
    target = 'unit_tests',
    source = Glob('tests/*_test.cpp') + [
                 'gtest/src/gtest-all.cc',
                 'gtest/src/gtest_main.cc'],
    LIBS = [egtb_gen,
            executor,
            player,
            evaluator,
            movegen,
            board,
            common,
            'pthread'],
    LIBPATH = '.')
